
<div *ngIf="isLoading" class="loading-overlay">
  <mat-icon class="loading-spinner rainbow-star">star</mat-icon>
</div>

<section class="area-riservata-section" *ngIf="!isLoading && utente">
  <h1 class="gradient-text">Ciao {{ utente.nome | titlecase }}, ecco il tuo conto!</h1>

  <div class="dashboard-layout">
    <div class="sidebar left">
      <div class="card info-card">
        <h2 class="gradient-text">Profilo</h2>
        <p><strong>Nome:</strong> {{ utente.nome }} {{ utente.cognome }}</p>
        <p><strong>Età:</strong> {{ utente.eta }}</p>
        <p><strong>Codice Fiscale:</strong> {{ utente.codiceFiscale }}</p>
        <p><strong>Residenza:</strong> {{ utente.indirizzoResidenza }}, {{ utente.comuneResidenza?.nomeComune }} </p>
       
         <button mat-stroked-button color="accent"  class="custom-operation-btn" style="height: 70px;"(click)="openModificaInformazioniDialog()">Modifica informazioni</button>
      
      </div>

      <div class="card investimenti-card">
        <h2 class="gradient-text">Investimenti</h2>
        <!--<h2 class="gradient-text">Investimenti</h2>
        <ul *ngIf="utente.iban?.investimenti?.length; else nessunInvestimento">
          <li *ngFor="let investimento of utente.iban?.investimenti">
            {{ investimento.fondo.nome }} – € {{ investimento.valoreAttuale | number:'1.2-2' }}
          </li>
        </ul>
        <ng-template #nessunInvestimento>
          <p>Nessun investimento disponibile.</p>
        </ng-template>-->
        <button mat-stroked-button color="accent" routerLink="/investimenti" class="custom-operation-btn" style="height: 70px;">
        Vai alla sezione Investimenti
        </button>

      </div>
    </div>

    <div class="main-content">
      <div class="card iban-card">
        <h2 class="gradient-text">Iban: {{ utente.iban?.iban }}</h2>
        <p><strong>Saldo Contabile:</strong> € {{ utente.iban?.saldoContabile | number:'1.2-2' }}</p>
        <p><strong>Saldo Disponibile:</strong> € {{ utente.iban?.saldoDisponibile | number:'1.2-2' }}</p>
      </div>

      <div class="card movimenti-card">
        <div class="movimenti-header">
  <span class="totale-entrate">
    Totale Entrate Mese: <span class="valore verde">€ {{ entrateMese | number:'1.2-2' }}</span>
  </span>

  <h2 class="gradient-text">Movimenti</h2>

  <span class="totale-uscite">
    Totale Uscite Mese: <span class="valore rosso">€ {{ usciteMese | number:'1.2-2' }}</span>
  </span>
</div>

        <button mat-stroked-button color="primary" class="operation-btn"
        (click)="scaricaEstrattoConto()">
  Scarica estratto conto mese corrente
</button>

        <div *ngIf="!utente.iban?.movimenti?.length">
          <p>Nessun movimento disponibile.</p>
        </div>

        <div class="movimenti-list" *ngIf="utente.iban?.movimenti?.length">
          <div class="movimento-card" *ngFor="let movimento of utente.iban?.movimenti">
            <div class="movimento-header">
              <span class="data">{{ movimento.dataMovimento | date:'longDate' }}</span>
              <span class="tipo">{{ movimento.tipoMovimento | titlecase }}</span>
              <span
                class="importo"
                [ngClass]="{'positivo': movimento.importo > 0, 'negativo': movimento.importo <= 0}">
                € {{ movimento.importo | number:'1.2-2' }}
              </span>
            </div>
            <div class="descrizione">{{ movimento.descrizione || 'Nessuna descrizione' }}</div>
            <div class="saldo-info">
              <span>Saldo prima: € {{ movimento.saldoPreMovimento | number:'1.2-2' }}</span>
              <span>Saldo dopo: € {{ movimento.saldoPostMovimento | number:'1.2-2' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="sidebar right">
      <div class="card carte-card">
        <h2 class="gradient-text">Carte</h2>
        <div *ngIf="utente.iban?.carte?.length===0">
          <p>Nessuna carta associata.</p>
        </div>
        <ul *ngIf="utente.iban?.carte?.length">
          <li *ngFor="let carta of utente.iban?.carte">
            <strong>{{ carta.tipoCarta }}</strong> • **** **** **** {{ carta.numeroCarta.toString().slice(-4) }} ({{ carta.circuito }})
            <button mat-icon-button color="warn" aria-label="Cancella carta" (click)="openConfermaCancellazioneCartaDialog(carta)">
            <mat-icon>remove_circle</mat-icon>
             </button>
          </li>
        </ul>

          <button mat-stroked-button color="accent"  class="custom-operation-btn" style="height: 70px;"(click)="openRichiestaCartaDialog()" 
    [disabled]="canRequestCard">
  Richiedi una nuova carta</button>
      

      </div>

      <div class="card operazioni-card">
        <h2 class="gradient-text">Operazioni</h2>
      
<button mat-raised-button color="warn" class="operation-btn bonifico-btn custom-operation-btn" (click)="openBonificoDialog()">
  Effettua Bonifico
</button>


        <button mat-stroked-button color="warn" class="custom-operation-btn" (click)="logout()">Logout</button>
      </div>
    </div>
  </div>
</section>
